var admin = "trunganh";
var user = "andrew";
var pass = "28111994";
var server = "127.0.0.1";
var port = "27017";
var dbname = "ChatApp-ByAndrew";
// var opt = {
// 	user : adminuser,
// 	pass : adminpass,
// 	auth : {
// 		authdb: 'admin'
// 	}
// }
var connString = "mongodb://localhost:27017/" + dbname;

var mongoose = require('mongoose');
var mongodb = require('mongodb');

var Schema = mongoose.Schema;

var userSchema = mongoose.Schema({
	token : String,
	email : String,
	username : String,
	hashed_password : String,
	salt : String,  
    gender : String,
    avatar : String,
    state : String,
    cover_image : String
});

var createDefaultCollection = function(username){
	var variable = {};
	var img_username = "image_" + username;
	var chat_username = "chat_" + username;
	var contact_username = "contact_" + username;
	var profile_username = "profile_" + username;

	variable[img_username] = mongoose.Schema({
		username : String,
		image : String,
		from_date : Date,
		thru_date : Date
	},{collection : img_username})
	variable[chat_username] = mongoose.Schema({
		username : String,
		guest : String,
		message : String,
		from_date : Date
	},{collection : chat_username});
	variable[contact_username] = mongoose.Schema({
		username : String,
		contact : String,
		state : String
	},{collection : contact_username});
	variable[profile_username] = mongoose.Schema({
		username : String,
		gender : String,
		age : Number,
		school_name : String,
		company_name : String,
		favorite : String,
		relationship_status : String,
		address : String
	},{collection : profile_username});

	module.exports[img_username] = mongoose.model(img_username, variable[img_username]);
	module.exports[chat_username] = mongoose.model(chat_username, variable[chat_username]);
	module.exports[contact_username] = mongoose.model(contact_username, variable[contact_username]);
	module.exports[profile_username] = mongoose.model(profile_username, variable[profile_username]);

	return module;
}

var find = function(collect, query, callback){
	mongoose.connection.db.collection(collect, function (err, collection) {
		    collection.find(query).toArray(callback);
		    });
}

mongoose.connect(connString);
var db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', function(){
})
module.exports = {
	user : mongoose.model('users', userSchema),
	createDefaultCollection : createDefaultCollection,
	find : find
};
